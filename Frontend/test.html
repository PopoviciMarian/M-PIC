<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
<script>
    function loginTwitter(){
        const twitter_login_link = localStorage.getItem('twitter_login_link');
        
        location.href = twitter_login_link;
    }
    
    function requestTwitterImages(){
        const user_id = localStorage.getItem('user_id');
        
        var myHeaders = new Headers();
        myHeaders.set('user_id', user_id);

        
        var requestOptions = {
            method: 'GET',
            redirect: 'follow',
            headers: myHeaders
        };
        fetch('http://localhost:8893/api/user/twitter/get_twitter_images', requestOptions)
            .then(response => response.json())
            .then(response => {
                
            })

    }
    function getCode(){
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const code = urlParams.get('oauth_verifier')
        if(code === null){
            
            var requestOptions = {
            method: 'GET',
            redirect: 'follow'
            };
 
            fetch("http://localhost:8893/api/user/twitter/oauthtoken", requestOptions)
            .then(response => response.json())
            .then(result => {
                
                console.log(result["message"]);
                localStorage.setItem('twitter_login_link', result["message"]["url"]);
                localStorage.setItem('twitter_oauth_token', result["message"]["oauth_token"]);
            })
            .catch(error => console.log('error', error));
        }
        else{
            console.log(code);
            const twitter_login_link = localStorage.getItem('twitter_login_link');
            const twitter_oauth_token= localStorage.getItem('twitter_oauth_token');

            var myHeaders = new Headers();
            myHeaders.set('twitter_oauth_token', ${twitter_oauth_token});
            myHeaders.set('code', ${code})

            var requestOptions = {
                method: 'GET',
                redirect: 'follow',
                headers: myHeaders
                };
            fetch('http://localhost:8893/api/user/twitter/access_token', requestOptions)
            .then(response => response.json())
            .then(response => {
                console.log(response);
                localStorage.setItem('user_id', response["message"]);
            })
        
        }
    }
 
 
</script>
 
</head>
<body onload="getCode()">
    <button  onclick="loginTwitter()">twitter</button>
    <button onclick="requestTwitterImages()">request images</button>"
<div id="status">
</body>
</html>